var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.getBabelPlugins=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _path=_interopRequireDefault(require("path"));var _webpack=_interopRequireDefault(require("webpack"));var getBabelPlugins=function getBabelPlugins(options){var reactNativeWeb='react-native-web';if(options.babelPlugins&&Array.isArray(options.babelPlugins)){return[reactNativeWeb].concat((0,_toConsumableArray2.default)(options.babelPlugins));}return[reactNativeWeb];};exports.getBabelPlugins=getBabelPlugins;var getModule=function getModule(name){return _path.default.join('node_modules',name);};var DEFAULT_INCLUDES=[getModule('react-native'),getModule('react-navigation'),getModule('unimodules'),getModule('@react'),getModule('@unimodules'),getModule('styled-components')];var DEFAULT_EXCLUDES=['/node_modules','/bower_components','(webpack)'];var webpackFinal=function(){var _ref=(0,_asyncToGenerator2.default)(function*(config,options){var _options$projectRoot,_options$modulesToTra,_options$modulesToTra2,_options$modulesToAli;config.plugins.push(new _webpack.default.DefinePlugin({'process.env.NODE_ENV':JSON.stringify(process.env.NODE_ENV||'development'),__DEV__:process.env.NODE_ENV!=='production'||true}));config.plugins.push(new _webpack.default.DefinePlugin({process:{env:{}}}));var babelPlugins=getBabelPlugins(options);var root=(_options$projectRoot=options.projectRoot)!=null?_options$projectRoot:process.cwd();var userModules=(_options$modulesToTra=(_options$modulesToTra2=options.modulesToTranspile)==null?void 0:_options$modulesToTra2.map(getModule))!=null?_options$modulesToTra:[];var modules=[].concat(DEFAULT_INCLUDES,(0,_toConsumableArray2.default)(userModules));var userAliases=(_options$modulesToAli=options.modulesToAlias)!=null?_options$modulesToAli:{};config.module.rules.push({test:/\.(js|jsx|ts|tsx)$/,loader:'babel-loader',include:function include(filename){if(!filename){return false;}for(var possibleModule of modules){if(filename.includes(_path.default.normalize(possibleModule))){return true;}}if(filename.includes(root)){for(var excluded of DEFAULT_EXCLUDES){if(filename.includes(_path.default.normalize(excluded))){return false;}}return true;}return false;},options:{root:root,presets:[['module:metro-react-native-babel-preset',{useTransformReactJSXExperimental:true}],['@babel/preset-react',{runtime:'automatic'}]],plugins:[].concat((0,_toConsumableArray2.default)(babelPlugins),['@babel/plugin-proposal-class-properties'])}});config.resolve.extensions=['.web.js','.web.jsx','.web.ts','.web.tsx'].concat((0,_toConsumableArray2.default)(config.resolve.extensions));config.resolve.alias=Object.assign({'react-native$':'react-native-web'},config.resolve.alias,userAliases);return config;});return function webpackFinal(_x,_x2){return _ref.apply(this,arguments);};}();module.exports=webpackFinal;